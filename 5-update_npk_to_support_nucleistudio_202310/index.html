<!DOCTYPE html>

<html class="writer-html5" lang="zh">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="../img/favicon.ico" rel="shortcut icon"/>
<title>升级npk.yml以支持Nuclei Studio 2023.10 - Nuclei Studio Supply Documents</title>
<link href="../css/theme.css" rel="stylesheet"/>
<link href="../css/theme_extra.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" rel="stylesheet"/>
<link href="../extra.css" rel="stylesheet"/>
<script>
        // Current page data
        var mkdocs_page_name = "\u5347\u7ea7npk.yml\u4ee5\u652f\u6301Nuclei Studio 2023.10";
        var mkdocs_page_input_path = "5-update_npk_to_support_nucleistudio_202310.md";
        var mkdocs_page_url = null;
      </script>
<!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
</head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href=".."> Nuclei Studio Supply Documents
        </a>
</div>
<div aria-label="导航栏" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<ul>
<li class="toctree-l1"><a class="reference internal" href="..">Home</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../1-cannot-setup-guestmemory/">因内存不足，导致在Nuclei Studio中启动qemu失败</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../2-qemu-glib-gio-unexpectedly/">windows 11下使用Nuclei Studio进行qemu调试程序时报错</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../3-print_memor_usage_in_ide/">How to print memory usage in Nuclei Studio</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../4-use_pre_build_or_post_build/">在编译工程时，使用了Pre-build Command/Post-build Command时报错</a>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal current" href="#">升级npk.yml以支持Nuclei Studio 2023.10</a>
<ul class="current">
<li class="toctree-l2"><a class="reference internal" href="#npkyml">npk.yml中的工具链升级</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#imafdcarchext">除标准的IMAFDC之外的扩展(ARCHEXT)的升级</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#libncrt">libncrt的升级</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#link-warning">Link Warning的消除</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#nuclei-sdk-050-npkyml">关于Nuclei SDK 0.5.0 npk.yml 详细变更</a>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../6-gcc13_gen_rvv_instructions_when_rvv_enabled/">GCC13 auto generated RVV instructions when RVV enabled</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../7-update_nucleistudio_202310_to_fixed_version/">更新 Nuclei Studio 2023.10 到最新修正版本</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../8-openocd_202310_flashloader_flaws/">OpenOCD在操作容量大于16M-Byte的nor-flash时的问题</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../9-modify_the_cproject_file_to_change_the_project_to_gcc13/">通过修改.cproject文件，升级工程工具链到GCC 13</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../10-compiling_projects_with_headless_in_nuclei_studio/">在Nuclei Studio下用命令行编译工程</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../11-openocd_reported_error_not_known_as_fespi_capable/">OpenOCD烧写程序时报错Error:Device ID 8xle2g8a6d is not known as FESPI capable</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../12-nucleisdk-0.5.0-dhrystone-score-lower-than-expected-in-IDE/">关于dhrystone在IDE上跑分和NSDK 0.5.0命令行跑分不一致的问题</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../13-error_could_not_find_an_available_hardware_trigger/">Error: Couldn't find an available hardware trigger / Error: can't add breakpoint: resource not available</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../14-cannot_find_-lncrt_balanced_no_such_file_or_directory/">cannot find -lncrt_balanced: No such file or directory</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../15-unsatisfiedLinkError_of_swt-win32-4965r8_dll_on_windows7/">UnsatisfiedLinkError of swt-win32-4965r8.dll on Windows 7</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../16-incomplete_data_output_when_using_profiling_function/">使用 Profiling 功能时可能遇到的一些问题</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../17-an_example_to_demonstrate_the_use_of_profiling_and_code_coverage/">Nuclei Studio使用Profiling功能进行性能调优举例</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../18-demonstrate_NICE_VNICE_acceleration_of_the_Nuclei_Model_through_profiling/">通过Profiling展示Nuclei Model NICE/VNICE指令加速</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../19-rapid_verification_of_NICE_VNICE_acceleration_with_Nuclei_Model_and_NICE_Wizard/">Nuclei Model结合Nice Wizard快速验证NICE/VNICE指令加速</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../20-quick_downloads_using_flash_programming/">Flash Programming</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../21-livewatch%20for%20monitoring%20variables/">Live Watch 功能的使用</a>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="移动导航栏" class="wy-nav-top" role="navigation">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="..">Nuclei Studio Supply Documents</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content"><div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a aria-label="文档" class="icon icon-home" href=".."></a></li>
<li class="breadcrumb-item active">升级npk.yml以支持Nuclei Studio 2023.10</li>
<li class="wy-breadcrumbs-aside">
<a class="icon icon-github" href="https://github.com/Nuclei-Software/nuclei-studio/blob/main/5-update_npk_to_support_nucleistudio_202310.md"> 在GitHub上编辑</a>
</li>
</ul>
<hr/>
</div>
<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main"><a class="md-content__icon pdf-download-btn" download href="../pdf/nuclei_studio_supply.pdf" title="Download"><i class="fa fas fa-download"></i><small> PDF</small></a>
<div class="section" itemprop="articleBody">
<h1 id="npkymlnuclei-studio-202310">升级npk.yml以支持Nuclei Studio 2023.10<a class="headerlink" href="#npkymlnuclei-studio-202310" title="Permanent link">¶</a></h1>
<p>在Nuclei Studio 2023.10中，一个重要变更，是支持GCC 13, 所以之前发布的NPK Package也需要做对应的变更，以更好的适用于Nuclei Studio 2023.10，其中有以下几个变更点。</p>
<blockquote>
<p>需要注意新版的npk.yml 不再支持以前 2022.12版本的IDE</p>
</blockquote>
<h2 id="npkyml">npk.yml中的工具链升级<a class="headerlink" href="#npkyml" title="Permanent link">¶</a></h2>
<p>在npk中，我们定义了buildconfig来自定义工程build时的各种参数，Nuclei Studio通过type标识使用的是那一种toolchain，如gcc、clang等，
通过 type-&gt;<strong>toolchain_name</strong> &amp; <strong>cross_prefix</strong> 来标识使用的toolchain里面具体的那个发行版本。升级SDK以支持GCC 13，对比以下两个例子不难看出，
只需要修改 toolchain_name: <strong>RISC-V GCC/Newlib</strong> 和 cross_prefix: <strong>riscv64-unknown-elf-</strong> ，就可以使SDK支持在创建工程时，可以选择GCC 13工具链。</p>
<p>以下内容是支持gcc 10 的buildconfig配置（为了方便举例，隐藏了部分参数，具体参数根据实际情况定义）。</p>
<div class="codehilite"><pre><span></span><code><span class="c1">## Build Configuration</span>
<span class="nt">buildconfig</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcc</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Nuclei GNU Toolchain</span>
<span class="w">    </span><span class="nt">cross_prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">riscv-nuclei-elf-</span><span class="w"> </span><span class="c1"># optional</span>
<span class="w">    </span><span class="nt">common_flags</span><span class="p">:</span><span class="w"> </span><span class="c1"># flags need to be combined together across all packages</span>
<span class="w">    </span><span class="nt">ldflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">asmflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cxxflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">common_defines</span><span class="p">:</span>
<span class="w">    </span><span class="nt">prebuild_steps</span><span class="p">:</span><span class="w"> </span><span class="c1"># could be override by app/bsp type</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span>
<span class="w">    </span><span class="nt">postbuild_steps</span><span class="p">:</span><span class="w"> </span><span class="c1"># could be override by app/bsp type</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span>
</code></pre></div>
<p>下以内容，是支持GCC 13和Clang的<strong>buildconfig</strong>配置（为了方便举例，隐藏了部分参数，具体参数根据实际情况定义）。</p>
<div class="codehilite"><pre><span></span><code><span class="c1">## Build Configuration</span>
<span class="nt">buildconfig</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcc</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Nuclei GNU Toolchain</span>
<span class="w">    </span><span class="c1"># 升级到 GCC13时，这里进行如下两行的改变</span>
<span class="w">    </span><span class="c1"># 且针对所有npk.yml的文件只要包含buildconfig的都需要进行修改，不仅仅限于ssp/bsp类型，还包括bsp/app/mwp/osp/sdk类型</span>
<span class="w">    </span><span class="nt">toolchain_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RISC-V GCC/Newlib</span>
<span class="w">    </span><span class="nt">cross_prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">riscv64-unknown-elf-</span><span class="w"> </span><span class="c1"># optional</span>
<span class="w">    </span><span class="nt">common_flags</span><span class="p">:</span><span class="w"> </span><span class="c1"># flags need to be combined together across all packages</span>
<span class="w">    </span><span class="nt">ldflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">asmflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cxxflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">common_defines</span><span class="p">:</span>
<span class="w">    </span><span class="nt">prebuild_steps</span><span class="p">:</span><span class="w"> </span><span class="c1"># could be override by app/bsp type</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span>
<span class="w">    </span><span class="nt">postbuild_steps</span><span class="p">:</span><span class="w"> </span><span class="c1"># could be override by app/bsp type</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">clang</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Nuclei LLVM Toolchain</span>
<span class="w">    </span><span class="nt">toolchain_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RISC-V Clang/Newlib</span>
<span class="w">    </span><span class="nt">cross_prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">riscv64-unknown-elf-</span><span class="w"> </span><span class="c1"># optional</span>
<span class="w">    </span><span class="nt">common_flags</span><span class="p">:</span><span class="w"> </span><span class="c1"># flags need to be combined together across all packages</span>
<span class="w">    </span><span class="nt">ldflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">asmflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cxxflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">common_defines</span><span class="p">:</span>
<span class="w">    </span><span class="nt">prebuild_steps</span><span class="p">:</span><span class="w"> </span><span class="c1"># could be override by app/bsp type</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span>
<span class="w">    </span><span class="nt">postbuild_steps</span><span class="p">:</span><span class="w"> </span><span class="c1"># could be override by app/bsp type</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span>
</code></pre></div>
<h2 id="imafdcarchext">除标准的IMAFDC之外的扩展(ARCHEXT)的升级<a class="headerlink" href="#imafdcarchext" title="Permanent link">¶</a></h2>
<blockquote>
<p>以下示例以Nuclei SDK 0.5.0的evalsoc的npk.yml升级举例， 仅考虑GCC的支持，如果需要考虑CLANG的支持，请参见 SDK中evalsoc的npk.yml的详细变更</p>
</blockquote>
<p>在GCC 13中，对RISC-V 指令扩展使用有了很大的变更，具体内容可以查看Nuclei Studio用户手册2.1.4章内容和Nuclei SDK中<strong>ARCH_EXT</strong>说明。</p>
<ul>
<li>
<p><a href="https://www.nucleisys.com/upload/files/doc/nucleistudio/Nuclei_Studio_User_Guide.202310.pdf">Nuclei Studio用户手册</a></p>
</li>
<li>
<p><a href="https://doc.nucleisys.com/nuclei_sdk/develop/buildsystem.html#arch-ext">ARCH_EXT说明</a></p>
</li>
</ul>
<p>升级npk.yml时，如果SDK中使用到了RISC-V 除了标准的<strong>IMAFDC</strong>之外指令扩展，例如<strong>B/P/K/V</strong>， 也需要升级对应的配置。</p>
<p>在NPK中，RISC-V 指令扩展以是<code>-march=xxx</code>的方式传递给Nuclei Studio，Nuclei Studio接收到相关配置，就会存储并应用到编译的过程中。
以Nuclei SDK中的npk.yml为例，通过下面这段配置我们就可以得到<code>-march=</code>的值，不难看出与RISC-V指令扩展相关的是NPK中的变量<strong>nuclei_archext</strong>。</p>
<div class="codehilite"><pre><span></span><code><span class="c1">## （为了方便举例，隐藏了部分参数，具体参数根据实际情况定义）</span>
<span class="c1">## Build Configuration</span>
<span class="nt">buildconfig</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcc</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Nuclei RISC-V GNU Toolchain</span><span class="w"> </span><span class="c1">#must</span>
<span class="w">    </span><span class="nt">cross_prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">riscv-nuclei-elf-</span><span class="w"> </span><span class="c1"># optional</span>
<span class="w">    </span><span class="nt">common_flags</span><span class="p">:</span><span class="w"> </span><span class="c1"># flags need to be combined together across all packages</span>
<span class="w">      </span><span class="c1"># 这里 -march 传递的值 就是 nuclei_core.arch 和 nuclei_archext 两个变量拼接而来</span>
<span class="w">      </span><span class="c1"># 例如 nuclei_core.arch设置为rv32imafdc, nuclei_archext设置为 _zba_zbb_zbc_zbs_xxldspn1x,</span>
<span class="w">      </span><span class="c1"># 那么 传递的就是 -march=rv32imafdc_zba_zbb_zbc_zbs_xxldspn1x</span>
<span class="w">      </span><span class="c1"># 如果你的 march是已知和确定的，这里直接就可以给定 -march/-mabi的选项，无需通过 configuration字段来进行传递</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">flags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-march=${nuclei_core.arch}$(join(${nuclei_archext},'')) -mabi=${nuclei_core.abi}</span>
<span class="w">    </span><span class="nt">ldflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">asmflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cxxflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">common_defines</span><span class="p">:</span>
<span class="w">    </span><span class="nt">prebuild_steps</span><span class="p">:</span><span class="w"> </span><span class="c1"># could be override by app/bsp type</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span>
<span class="w">    </span><span class="nt">postbuild_steps</span><span class="p">:</span><span class="w"> </span><span class="c1"># could be override by app/bsp type</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span>
</code></pre></div>
<p>在旧版的SDK中，nuclei_archext定义的是一个<code>multicheckbox</code>，用户可以自己选择，而在新版的SDK中<code>nuclei_archext</code>定义的是一个<code>text</code>输入框，
这样用户可以更灵活的使用RISC-V 指令扩展，如果在某些工程或场景下，想要预设一些RISC-V 指令扩展，建议给一个默认值就可以了，可以参考下代的示例代码。</p>
<ul>
<li>用于支持<strong>Nuclei RISC-V Toolchain 2022.12</strong>的写法</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="w">  </span><span class="c1">## 旧版的SDK中，nuclei_archext定义的是一个multicheckbox</span>
<span class="w">  </span><span class="c1">##（为了方便举例，隐藏了部分参数，具体参数根据实际情况定义）</span>
<span class="w">  </span><span class="nt">nuclei_archext</span><span class="p">:</span>
<span class="w">    </span><span class="nt">default_value</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">multicheckbox</span>
<span class="w">    </span><span class="nt">global</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Nuclei ARCH Extensions</span>
<span class="w">    </span><span class="nt">choices</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">b</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Bitmanip Extension</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">p</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Packed SIMD Extension</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Vector Extension</span>
</code></pre></div>
<ul>
<li>用于支持<strong>Nuclei RISC-V Toolchain 2023.10</strong>的写法</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="c1">## 新版的SDK中nuclei_archext定义的是一个text输入框</span>
<span class="w">    </span><span class="c1">## Package Configurations</span>
<span class="w">    </span><span class="nt">configuration</span><span class="p">:</span>
<span class="w">    </span><span class="nt">nuclei_archext</span><span class="p">:</span>
<span class="w">        </span><span class="nt">default_value</span><span class="p">:</span><span class="w"> </span><span class="s">"_zba_zbb_zbc_zbs"</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">text</span>
<span class="w">        </span><span class="nt">global</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="c1"># hints and tips are introduced in Nuclei Studio 2023.10</span>
<span class="w">        </span><span class="c1"># used to show tool tips and input hints</span>
<span class="w">        </span><span class="nt">tips</span><span class="p">:</span><span class="w"> </span><span class="s">"Possible</span><span class="nv"> </span><span class="s">other</span><span class="nv"> </span><span class="s">ISA</span><span class="nv"> </span><span class="s">extensions,</span><span class="nv"> </span><span class="s">seperated</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">underscores,</span><span class="nv"> </span><span class="s">like</span><span class="nv"> </span><span class="s">'_zba_zbb_zbc_zbs_xxldspn1x'"</span>
<span class="w">        </span><span class="nt">hints</span><span class="p">:</span><span class="w"> </span><span class="s">"_zba_zbb_zbc_zbs_xxldspn1x"</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Nuclei ARCH Extensions</span>
</code></pre></div>
<p>最终显示创建项目的时候显示效果如下</p>
<p><img alt="" src="../asserts/images/5/create_project.png"/></p>
<h2 id="libncrt">libncrt的升级<a class="headerlink" href="#libncrt" title="Permanent link">¶</a></h2>
<p>libncrt较之前也有了些许变化，在NPK中使用libncrt之前，新旧版SDK中都是一样的在<strong>conifguration</strong>中定义了一个变量<code>stdclib</code>，
它的值是一个下拉框，可以选择不同的值。不同点是在得到<code>stdclib</code>后，在<code>common_flags</code>或者其它地方使用<code>stdclib</code>时略有不同。</p>
<p>关于<code>stdclib</code>的一些说明，可以参见 <a href="https://doc.nucleisys.com/nuclei_sdk/develop/buildsystem.html#stdclib">这里</a></p>
<div class="codehilite"><pre><span></span><code><span class="c1">## 定义stdclib变量</span>
<span class="c1">##（为了方便举例，隐藏了部分参数，具体参数根据实际情况定义）</span>
<span class="c1">## Package Configurations</span>
<span class="nt">configuration</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stdclib</span><span class="p">:</span>
<span class="w">    </span><span class="nt">default_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">newlib_nano</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">choice</span>
<span class="w">    </span><span class="nt">global</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Standard C Library</span>
<span class="w">    </span><span class="nt">choices</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">newlib_full</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">newlib with full feature</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">newlib_fast</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">newlib nano with printf/scanf float</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">newlib_small</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">newlib nano with printf float</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">newlib_nano</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">newlib nano without printf/scanf float</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">libncrt_fast</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nuclei c runtime library, optimized for speed</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">libncrt_balanced</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nuclei c runtime library, balanced, full feature</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">libncrt_small</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nuclei c runtime library, optimized for size, full feature</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">libncrt_nano</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nuclei c runtime library, optimized for size, no float support</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">libncrt_pico</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nuclei c runtime library, optimized for size, no long/long long support</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nostd</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no std c library will be used, and don't search the standard system directories for header files</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nospec</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no std c library will be used, not pass any --specs options</span>
</code></pre></div>
<p>在新版的SDK中，如果使用<code>--specs=libncrt_xxx.specs</code> 或者链接库里面包含 <code>-lncrt_xxx</code> （表示采用libncrt c库），
则需变更为 <code>-lncrt_xxx -lfileops_uart -lheapops_basic</code>，这也是旧SDK变更为支持GCC 13的新SDK的原则。</p>
<p>下面配置为在旧版SDK中的npk变量stdclib,当变量stdclib以libncrt开头时，会直接定义一个<code>--specs=${stdclib}.specs</code>，
按照上面我们说的原则，这里应该变成设置<code>-l$(subst(${stdclib},lib,)) -lfileops_uart -lheapops_basic</code>，所以在新版SDK中的写法就变成了下面的配置方式。</p>
<div class="codehilite"><pre><span></span><code><span class="c1">## 在旧版SDK中使用stdclib变量</span>
<span class="c1">##（为了方便举例，隐藏了部分参数，具体参数根据实际情况定义）</span>
<span class="c1">## Build Configuration</span>
<span class="nt">buildconfig</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcc</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Nuclei GNU Toolchain</span>
<span class="w">    </span><span class="nt">cross_prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">riscv-nuclei-elf-</span><span class="w"> </span><span class="c1"># optional</span>
<span class="w">    </span><span class="nt">common_flags</span><span class="p">:</span><span class="w"> </span><span class="c1"># flags need to be combined together across all packages</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">flags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--specs=${stdclib}.specs</span>
<span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$( startswith(${stdclib}, "libncrt") )</span>
<span class="w">    </span><span class="nt">ldflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">asmflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cxxflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">common_defines</span><span class="p">:</span>
<span class="w">    </span><span class="nt">prebuild_steps</span><span class="p">:</span><span class="w"> </span><span class="c1"># could be override by app/bsp type</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span>
<span class="w">    </span><span class="nt">postbuild_steps</span><span class="p">:</span><span class="w"> </span><span class="c1"># could be override by app/bsp type</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span>
</code></pre></div>
<p><strong>转变为</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">## 在新版SDK中使用stdclib变量</span>
<span class="c1">##（为了方便举例，隐藏了部分参数，具体参数根据实际情况定义）</span>
<span class="c1">## Build Configuration</span>
<span class="nt">buildconfig</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcc</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Nuclei GNU Toolchain</span>
<span class="w">    </span><span class="nt">toolchain_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RISC-V GCC/Newlib</span>
<span class="w">    </span><span class="nt">cross_prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">riscv64-unknown-elf-</span><span class="w"> </span><span class="c1"># optional</span>
<span class="w">    </span><span class="nt">common_flags</span><span class="p">:</span><span class="w"> </span><span class="c1"># flags need to be combined together across all packages</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">flags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--specs=${stdclib}.specs</span>
<span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$( startswith(${stdclib}, "libncrt") )</span>
<span class="w">    </span><span class="nt">ldflags</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">flags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-l$(subst(${stdclib},lib,)) -lheapops_basic -lfileops_uart</span>
<span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$( startswith(${stdclib}, "libncrt") )</span>
<span class="w">    </span><span class="nt">cflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">asmflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cxxflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">common_defines</span><span class="p">:</span>
<span class="w">    </span><span class="nt">prebuild_steps</span><span class="p">:</span><span class="w"> </span><span class="c1"># could be override by app/bsp type</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span>
<span class="w">    </span><span class="nt">postbuild_steps</span><span class="p">:</span><span class="w"> </span><span class="c1"># could be override by app/bsp type</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span>
</code></pre></div>
<h2 id="link-warning">Link Warning的消除<a class="headerlink" href="#link-warning" title="Permanent link">¶</a></h2>
<p>在Nuclei Studio 2023.10中集成的GCC 13,在使用过程中会有warning，链接选项增加一个<code>-Wl,--no-warn-rwx-segments</code>可以隐藏warning。</p>
<p>具体可以参考以下配置（为了方便举例，隐藏了部分参数，具体参数根据实际情况定义）</p>
<div class="codehilite"><pre><span></span><code><span class="c1">## Build Configuration</span>
<span class="nt">buildconfig</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcc</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Nuclei GNU Toolchain</span>
<span class="w">    </span><span class="nt">toolchain_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RISC-V GCC/Newlib</span>
<span class="w">    </span><span class="nt">cross_prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">riscv64-unknown-elf-</span><span class="w"> </span><span class="c1"># optional</span>
<span class="w">    </span><span class="nt">common_flags</span><span class="p">:</span><span class="w"> </span><span class="c1"># flags need to be combined together across all packages</span>
<span class="w">    </span><span class="nt">ldflags</span><span class="p">:</span>
<span class="w">       </span><span class="c1"># 用于消除gcc13链接阶段的warning</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">flags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-Wl,--no-warn-rwx-segments</span>
<span class="w">    </span><span class="nt">cflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">asmflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cxxflags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">common_defines</span><span class="p">:</span>
<span class="w">    </span><span class="nt">prebuild_steps</span><span class="p">:</span><span class="w"> </span><span class="c1"># could be override by app/bsp type</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span>
<span class="w">    </span><span class="nt">postbuild_steps</span><span class="p">:</span><span class="w"> </span><span class="c1"># could be override by app/bsp type</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span>
</code></pre></div>
<h2 id="nuclei-sdk-050-npkyml">关于Nuclei SDK 0.5.0 npk.yml 详细变更<a class="headerlink" href="#nuclei-sdk-050-npkyml" title="Permanent link">¶</a></h2>
<p>关于支持Nuclei Studio + Nuclei RISC-V Toolchain 2023.10的npk.yml变更，可以参考nuclei-sdk 0.5.0的变更。</p>
<ul>
<li>
<p>gd32vf103的变化 <code>git diff 0.4.1..0.5.0 SoC/gd32vf103/***npk.yml</code></p>
</li>
<li>
<p>evalsoc的变化: <code>git diff 0.4.1..0.5.0 SoC/evalsoc/***npk.yml</code></p>
</li>
<li>
<p>NMSIS的变化: <code>git diff 0.4.1..0.5.0 NMSIS/***npk.yml</code></p>
</li>
<li>
<p>application的变化: <code>git diff 0.4.1..0.5.0 application/***npk.yml</code></p>
</li>
<li>
<p>RTOS的变化: <code>git diff 0.4.1..0.5.0 OS/***npk.yml</code></p>
</li>
</ul>
<p>执行查看代码变更命令方法如下</p>
<div class="codehilite"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/Nuclei-Software/nuclei-sdk/
<span class="nb">cd</span><span class="w"> </span>nuclei-sdk
git<span class="w"> </span>fetch<span class="w"> </span>--all<span class="w"> </span>
git<span class="w"> </span>diff<span class="w"> </span><span class="m">0</span>.4.1..0.5.0<span class="w"> </span>SoC/gd32vf103/***npk.yml
git<span class="w"> </span>diff<span class="w"> </span><span class="m">0</span>.4.1..0.5.0<span class="w"> </span>SoC/evalsoc/***npk.yml
git<span class="w"> </span>diff<span class="w"> </span><span class="m">0</span>.4.1..0.5.0<span class="w"> </span>NMSIS/***npk.yml
git<span class="w"> </span>diff<span class="w"> </span><span class="m">0</span>.4.1..0.5.0<span class="w"> </span>application/***npk.yml
git<span class="w"> </span>diff<span class="w"> </span><span class="m">0</span>.4.1..0.5.0<span class="w"> </span>OS/***npk.yml
</code></pre></div>
</div>
</div><footer>
<div aria-label="页脚导航" class="rst-footer-buttons" role="navigation">
<a class="btn btn-neutral float-left" href="../4-use_pre_build_or_post_build/" title="在编译工程时，使用了Pre-build Command/Post-build Command时报错"><span class="icon icon-circle-arrow-left"></span> 上一章</a>
<a class="btn btn-neutral float-right" href="../6-gcc13_gen_rvv_instructions_when_rvv_enabled/" title="GCC13 auto generated RVV instructions when RVV enabled">下一章 <span class="icon icon-circle-arrow-right"></span></a>
</div>
<hr/>
<div role="contentinfo">
<!-- Copyright etc -->
<p>All rights reserved</p>
</div>

  用<a href="https://www.mkdocs.org/">MkDocs</a>构建，使用<a href="https://readthedocs.org">Read the Docs</a>提供的<a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>。
</footer>
</div>
</div>
</section>
</div>
<div aria-label="版本" class="rst-versions" role="note">
<span class="rst-current-version" data-toggle="rst-current-version">
<span>
<a class="fa fa-github" href="https://github.com/Nuclei-Software/nuclei-studio" style="color: #fcfcfc"> GitHub</a>
</span>
<span><a href="../4-use_pre_build_or_post_build/" style="color: #fcfcfc">« 上一章</a></span>
<span><a href="../6-gcc13_gen_rvv_instructions_when_rvv_enabled/" style="color: #fcfcfc">下一章 »</a></span>
</span>
</div>
<script src="../js/jquery-3.6.0.min.js"></script>
<script>var base_url = "..";</script>
<script src="../js/theme_extra.js"></script>
<script src="../js/theme.js"></script>
<script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>
</body>
</html>
